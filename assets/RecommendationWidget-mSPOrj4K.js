import{r as h,j as e}from"./index-CRFhanc3.js";import{e as j,a as S,n as k,f as w,S as A}from"./App-CTFBvRA4.js";import{L as R}from"./lightbulb-BbdhZdTO.js";const M=(t,s)=>{const{riskProfile:a,preferences:r,investmentAmount:o}=s,x=t.filter(m=>!(r.isr&&!m.isr||r.european&&!m.european||r.noFees&&m.fees>0||r.excludedSectors.includes(m.sector)||r.sectors.length>0&&!r.sectors.includes(m.sector))).map(m=>{let u=0,g=[];const p=z(m.yield,a);u+=p*.4,p>.7&&g.push("Rendement attractif");const f=L(m.sector,a);u+=f*.2,f>.8&&g.push("Secteur recommandé");const b=C(m.geography,a);u+=b*.15,b>.8&&g.push("Zone géographique adaptée");const y=I(m);u+=y*.15,y>.8&&g.push("SCPI de qualité");const v=q(m.capitalization);return u+=v*.1,v>.8&&g.push("Bonne liquidité"),{scpi:m,score:Math.min(u,1),reason:g.join(", ")||"SCPI adaptée à votre profil"}});x.sort((m,u)=>u.score-m.score);const c=Y(x,a),l=D(c,a),n=F(l,a),{warnings:d,suggestions:N}=E(l,a,s);return{recommendations:l,totalScore:l.reduce((m,u)=>m+u.score,0)/l.length,riskAnalysis:n,warnings:d,suggestions:N}},z=(t,s)=>{const{min:a,max:r}=s.targetYield;if(t<a){const o=s.riskLevel<=3?.8:.5;return Math.max(.3,t/a*o)}if(t>r){const o=s.riskLevel<=3?.9:1;return Math.min(1,o)}return .8+(t-a)/(r-a)*.2},L=(t,s)=>{if(s.preferredSectors.length===0)return .7;if(s.preferredSectors.includes(t))return 1;const r={sante:.9,commerces:.8,bureaux:.7,residentiel:.6,logistique:.5,hotellerie:.4,diversifie:.6}[t]||.5;return s.riskLevel<=2?r:1-r+.5},C=(t,s)=>{if(s.preferredGeography.length===0)return .7;if(s.preferredGeography.includes(t))return 1;const r={france:.9,europe:.7,international:.5}[t]||.5;return s.riskLevel<=2?r:Math.min(1,r+.3)},I=t=>{let s=.5;t.tof>=95?s+=.2:t.tof>=90&&(s+=.1),t.isr&&(s+=.1);const a=new Date().getFullYear()-t.creation;return a>=10?s+=.1:a>=5&&(s+=.05),t.fees===0&&(s+=.05),Math.min(s,1)},q=t=>t>=1e9?1:t>=5e8?.8:t>=1e8?.6:t>=5e7?.4:.2,Y=(t,s)=>{const a=[],r=new Set,o=new Set,i=s.riskLevel<=3?Math.max(s.minDiversification,4):Math.max(s.minDiversification,6),x=s.riskLevel<=3?t.sort((c,l)=>l.score-c.score):t;for(const c of x){if(a.length>=i)break;(s.riskLevel<=3?c.score>.4:a.length<3||!r.has(c.scpi.sector)||r.size<3)&&(a.push(c),r.add(c.scpi.sector),o.add(c.scpi.geography))}for(const c of t){if(a.length>=i)break;a.find(l=>l.scpi.id===c.scpi.id)||a.push(c)}return a.slice(0,i)},D=(t,s,a)=>{const r=t.reduce((o,i)=>o+i.score,0);return t.map(o=>{let i=o.score/r*100;return i=Math.min(i,s.maxSingleAllocation),{scpi:o.scpi,allocation:Math.round(i*10)/10,reason:o.reason,score:o.score}})},F=(t,s)=>{const a=t.reduce((n,d)=>n+d.scpi.yield*d.allocation/100,0),r=new Set(t.map(n=>n.scpi.sector)),o=new Set(t.map(n=>n.scpi.geography)),i=Math.min(1,(r.size+o.size)/8),x=Math.min(1,a/10),l=a>=s.targetYield.min&&a<=s.targetYield.max?.9:.6;return{averageYield:a,diversificationScore:i,riskScore:x,suitabilityScore:l}},E=(t,s,a)=>{const r=[],o=[],i=t.reduce((l,n)=>l+n.scpi.yield*n.allocation/100,0);return i<s.targetYield.min&&r.push(`Rendement moyen (${i.toFixed(2)}%) inférieur à votre objectif`),t.length<s.minDiversification&&r.push("Portefeuille insuffisamment diversifié"),Math.max(...t.map(l=>l.allocation))>s.maxSingleAllocation&&r.push("Concentration trop élevée sur une SCPI"),a.age<40&&s.riskLevel<3&&o.push("Avec votre âge, vous pourriez envisager un profil plus dynamique"),a.investmentHorizon>15&&i<6&&o.push("Avec un horizon long terme, vous pourriez viser un rendement plus élevé"),new Set(t.map(l=>l.scpi.sector)).size<3&&o.push("Considérez une diversification sectorielle plus large"),{warnings:r,suggestions:o}},B=({clientProfile:t,availableScpi:s,onApplyRecommendations:a})=>{const[r,o]=h.useState(null),[i,x]=h.useState(!1);if(!t)return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(j,{className:"w-16 h-16 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Recommandations personnalisées"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Définissez votre profil d'investisseur pour recevoir des recommandations adaptées"})]})});h.useEffect(()=>{t&&s.length>0&&c()},[t,s]);const c=async()=>{x(!0);try{await new Promise(d=>setTimeout(d,1e3));const n=M(s,t);o(n)}catch(n){console.error("Erreur lors de la génération des recommandations:",n)}finally{x(!1)}},l=()=>{if(r){const n=r.recommendations.map(d=>({scpi:d.scpi,investedAmount:Math.round(d.allocation/100*t.investmentAmount),percentage:d.allocation,allocation:d.allocation,reason:d.reason}));a(n)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-200 dark:border-gray-600",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:"Recommandations IA"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:t.riskProfile.icon}),e.jsxs("span",{className:"text-sm font-medium",style:{color:t.riskProfile.color},children:["Profil ",t.riskProfile.name]})]})]})}),i&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Analyse de ",s.length," SCPI en cours..."]})]}),r&&!i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-3 rounded-lg text-center border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[r.riskAnalysis.averageYield.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-green-700 dark:text-green-300",children:"Rendement moyen"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-center border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:[Math.round(r.riskAnalysis.diversificationScore*100),"%"]}),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Diversification"})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-3 rounded-lg text-center border border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:[Math.round(r.riskAnalysis.suitabilityScore*100),"%"]}),e.jsx("div",{className:"text-xs text-purple-700 dark:text-purple-300",children:"Adéquation"})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 p-3 rounded-lg text-center border border-orange-200 dark:border-orange-800",children:[e.jsx("div",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:r.recommendations.length}),e.jsx("div",{className:"text-xs text-orange-700 dark:text-orange-300",children:"SCPI sélectionnées"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"Portefeuille recommandé"]}),e.jsx("div",{className:"space-y-2",children:r.recommendations.map((n,d)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n.scpi.name}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[n.reason," • ",n.scpi.yield.toFixed(2),"% rendement"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-blue-600 dark:text-blue-400",children:[n.allocation.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:k(n.allocation/100*t.investmentAmount)})]})]},n.scpi.id))})]}),r.warnings.length>0&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"font-semibold text-yellow-800 dark:text-yellow-300",children:"Points d'attention"})]}),e.jsx("ul",{className:"text-sm text-yellow-700 dark:text-yellow-300 space-y-1",children:r.warnings.map((n,d)=>e.jsxs("li",{children:["• ",n]},d))})]}),r.suggestions.length>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"font-semibold text-blue-800 dark:text-blue-300",children:"Suggestions d'optimisation"})]}),e.jsx("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:r.suggestions.map((n,d)=>e.jsxs("li",{children:["• ",n]},d))})]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-green-600 dark:bg-green-500 text-white rounded-lg font-semibold hover:bg-green-700 dark:hover:bg-green-600 transition-colors shadow-lg hover:shadow-xl hover:-translate-y-0.5 transform duration-200",children:[e.jsx(A,{className:"w-5 h-5"}),"Appliquer ces recommandations"]})]}),!r&&!i&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(j,{className:"w-16 h-16 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Recommandations personnalisées"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Obtenez un portefeuille optimisé selon votre profil de risque"}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Montant: ",k(t.investmentAmount)," • Horizon: ",t.investmentHorizon," ans"]})]})]})};export{B as default};
